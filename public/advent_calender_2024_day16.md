---
title: è¦‹ãŸç›®ã®å˜ä½ã§æ–‡å­—ã‚’æ‰±ã†ã«ã¯ï¼Ÿæ›¸è¨˜ç´ ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã¨ã‚¼ãƒ­å¹…æ¥åˆå­
tags:
  - JavaScript
private: false
updated_at: ''
id: null
organization_url_name: null
slide: false
ignorePublish: false
---
## JavaScriptã¨UTF-16
JavaScript ã¯ã€å†…éƒ¨çš„ãªæ–‡å­—åˆ—ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã«UTF-16ã‚’ä½¿ç”¨ã—ã¦ãŠã‚Šã€16bit ï¼ˆ2byteï¼‰å˜ä½ã§1ã¤ã®æ–‡å­—ã‚’è¡¨ã—ã¦ã„ã¾ã™ã€‚

ã—ã‹ã—ã€16bit ã§ã¯æœ€å¤§ã§2^16å€‹ã®å€¤ã—ã‹è¡¨ç¾ã§ããªã„ãŸã‚ã€32bit ã§1æ–‡å­—ã‚’è¡¨ç¾ã™ã‚‹ã‚µãƒ­ã‚²ãƒ¼ãƒˆãƒšã‚¢æ–‡å­—ã‚„ã€ã‚¼ãƒ­å¹…æ¥åˆå­ã¨ã‚ˆã°ã‚Œã‚‹åˆ¶å¾¡æ–‡å­—ã‚’ä½¿ã£ã¦æ–‡å­—åŒå£«ã‚’çµåˆã—ã¦åˆ¥ã®æ–‡å­—ã‚’è¡¨ã—ãŸã‚Šã¨ã„ã£ãŸã“ã¨ã‚’ã—ã¦ã„ã¾ã™ã€‚

ã‚µãƒ­ã‚²ãƒ¼ãƒˆãƒšã‚¢æ–‡å­—ã‚„ã‚¼ãƒ­å¹…æ¥åˆå­ã«ã‚ˆã£ã¦çµåˆã•ã‚ŒãŸæ–‡å­—ã¯ã€`split()`ã«ã‚ˆã£ã¦åˆ†å‰²ã™ã‚‹ã¨è¦‹ãŸç›®ã®1æ–‡å­—ãšã¤ã«ã¯åˆ†å‰²ã•ã‚Œãªã‹ã£ãŸã‚Šã¨ä¸éƒ½åˆãªã“ã¨ãŒèµ·ã“ã‚Šã¾ã™ã€‚

ã“ã®è¨˜äº‹ã§ã¯ã€è¦‹ãŸç›®ã®1æ–‡å­—ã‚’1ã¤ã®å˜ä½ã¨ã—ã¦æ‰±ã†æ–¹æ³•ã«ã¤ã„ã¦ã¿ã¦ã„ãã¾ã™ã€‚

## æ›¸è¨˜ç´ ã‚¯ãƒ©ã‚¹ã‚¿ï¼ˆGrapheme Clusterï¼‰
ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒ1æ–‡å­—ã¨ã—ã¦èªè­˜ã™ã‚‹ã€è¦‹ãŸç›®ã®1æ–‡å­—ã®ã“ã¨ã‚’**æ›¸è¨˜ç´ ã‚¯ãƒ©ã‚¹ã‚¿**ã¨ã„ã„ã¾ã™ã€‚
`"ãŒ"`ã‚„`"Ã©"`ã€`"ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦"`ãªã©ã€è¦‹ãŸç›®ã§1æ–‡å­—ã¨èªè­˜ã•ã‚Œã‚‹å˜ä½ãŒæ›¸è¨˜ç´ ã‚¯ãƒ©ã‚¹ã‚¿ã§ã™ã€‚

`split()`ã«ã‚ˆã£ã¦ã€æ–‡å­—åˆ—ã®1æ–‡å­—ãšã¤ã‚’è¦ç´ ã«æŒã¤é…åˆ—ã«å¤‰æ›ã—ã¦ã¿ã‚‹ã“ã¨ã‚’è€ƒãˆã¦ã¿ã¾ã™ã€‚
```js
console.log('ã‚ã„ã†ãˆãŠabc123'.split('')) //["ã‚", "ã„", "ã†", "ãˆ", "ãŠ", "a", "b", "c", "1", "2", "3"] 
```
ã“ã®ä¾‹ã§ã¯è¦‹ãŸç›®ã®1æ–‡å­—ãšã¤ã«åˆ†å‰²ã•ã‚Œã¦ã„ã¾ã™ã€‚
`split()`ã¯16bit å˜ä½ã§æ–‡å­—åˆ—ã‚’åˆ†å‰²ã—ã¦ã„ããŸã‚ã€16bit ã§è¡¨ã•ã‚Œã‚‹æ–‡å­—[^1]ã®ã¿ã§æ§‹æˆã•ã‚Œã¦ã„ã‚‹æ–‡å­—åˆ—ã«ã¤ã„ã¦ã¯ã†ã¾ãåˆ†å‰²ã§ãã¾ã™ã€‚

ã—ã‹ã—ã€`"ğ©¸½"`ã‚„`"ğ ®·"`ã¨ã„ã£ãŸã‚µãƒ­ã‚²ãƒ¼ãƒˆãƒšã‚¢æ–‡å­—ã«ãŸã„ã—ã¦`split()`ã‚’é©ç”¨ã—ã¦ã¿ã‚‹ã¨ã€ä»¥ä¸‹ã®ã‚ˆã†ãªçµæœã¨ãªã‚Šã¾ã™ã€‚
```js
console.log('ğ©¸½ã¨ğ ®·'.split('')) //["ï¿½", "ï¿½", "ã¨", "ï¿½", "ï¿½"]
```
è¦‹ãŸç›®é€šã‚Šã®æ–‡å­—ã§åˆ†å‰²ã•ã‚Œã¦ãŠã‚‰ãšã€`"ï¿½"`ã¨ã„ã†æ–‡å­—ãŒè¡¨ç¤ºã•ã‚Œã¦ã—ã¾ã£ã¦ã„ã¾ã™ã€‚
### `"ï¿½"`: REPLACEMENT CHARACTER
`"ï¿½"`ã¯Unicodeç½®æ›æ–‡å­—ï¼ˆREPLACEMENT CHARACTERï¼‰ã¨å‘¼ã°ã‚Œã‚‹æ–‡å­—ã§ã€`U+FFFD`ã§è¡¨ã•ã‚Œã¾ã™ã€‚
ã‚µãƒ­ã‚²ãƒ¼ãƒˆãƒšã‚¢ã‚’æŒ‡å®šã™ã‚‹32bit ã®ã†ã¡ã®ç‰‡æ–¹16bitï¼ˆå­¤ç«‹ã‚µãƒ­ã‚²ãƒ¼ãƒˆï¼‰ã‚„æœªå®šç¾©ã®ã‚³ãƒ¼ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’æŒ‡å®šã—ãŸã¨ããªã©ã€èªè­˜ã§ããªã„æ–‡å­—ã‚„è¡¨ç¾ã§ããªã„æ–‡å­—ã®ç½®ãæ›ãˆå…ˆã¨ã—ã¦ä½¿ã‚ã‚Œã¦ã„ã¾ã™ã€‚
ã“ã®æ–‡å­—1ã¤ã§1ã¤ã®æ›¸è¨˜ç´ ã‚¯ãƒ©ã‚¹ã‚¿ã¨ã—ã¦æ‰±ã‚ã‚Œã¾ã™ã€‚

### ã‚µãƒ­ã‚²ãƒ¼ãƒˆãƒšã‚¢æ–‡å­—ã‚’æ›¸è¨˜ç´ ã‚¯ãƒ©ã‚¹ã‚¿å˜ä½ã§åˆ†å‰²ã™ã‚‹ã«ã¯
`"ğ©¸½"`ã‚„`"ğ ®·"`ã¨ã„ã£ãŸã‚µãƒ­ã‚²ãƒ¼ãƒˆãƒšã‚¢æ–‡å­—ã‚’æ›¸è¨˜ç´ ã‚¯ãƒ©ã‚¹ã‚¿å˜ä½ã§é…åˆ—ã«æ ¼ç´ã™ã‚‹ã«ã¯ã€`Arry.from`ã‚„ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰æ§‹æ–‡`[...]`ãŒæœ‰ç”¨ã§ã™ã€‚
```js
console.log(Array.from('ğ©¸½ã¨ğ ®·')) //["ğ©¸½", "ã¨", "ğ ®·"] 
console.log([...'ğ©¸½ã¨ğ ®·'])        //["ğ©¸½", "ã¨", "ğ ®·"] 
```
`Array.from`ã‚„`[...]`ã¯UTF-16ã®ã‚³ãƒ¼ãƒ‰ãƒ¦ãƒ‹ãƒƒãƒˆå˜ä½ï¼ˆ16bitï¼‰ã§ã¯ãªãã€ã‚³ãƒ¼ãƒ‰ãƒã‚¤ãƒ³ãƒˆå˜ä½ã§åˆ†å‰²ã—ã¾ã™ã€‚

ã“ã®æ–¹æ³•ã§ã‚µãƒ­ã‚²ãƒ¼ãƒˆãƒšã‚¢æ–‡å­—ã‚’è¦‹ãŸç›®ã®1æ–‡å­—ãšã¤æ‰±ã†ã“ã¨ãŒã§ãã‚‹ã‚ã‘ã§ã™ãŒã€ã“ã®æ–¹æ³•ã§ã‚‚è¦‹ãŸç›®ã®é€šã‚Šã«ã¯åˆ†å‰²ã§ããªã„æ–‡å­—ãŒå­˜åœ¨ã—ã¾ã™ã€‚
ä¾‹ãˆã°ã€`ğŸ§‘â€ğŸ§‘â€ğŸ§’`ãªã©ã¯è¤‡æ•°ã®çµµæ–‡å­—ãŒçµåˆã—ã¦ã§ãã¦ã„ã‚‹ãŸã‚ã€ã‚³ãƒ¼ãƒ‰ãƒã‚¤ãƒ³ãƒˆå˜ä½ã§åˆ†å‰²ã—ã¦ã‚‚è¦‹ãŸç›®ã®é€šã‚Šã«åˆ†ã‹ã‚Œã¾ã›ã‚“ã€‚
```js
console.log(Array.from('ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦')) //["ğŸ‘¨", "â€", "ğŸ‘©", "â€", "ğŸ‘§", "â€", "ğŸ‘¦"] 
```
`"ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦"`ã¯çµµæ–‡å­—ãŒã‚¼ãƒ­å¹…æ¥åˆå­ï¼ˆZWJï¼‰ã¨å‘¼ã°ã‚Œã‚‹åˆ¶å¾¡æ–‡å­—ã§çµåˆã•ã‚Œã‚‹ã“ã¨ã§ä½œã‚‰ã‚Œã¦ã„ã¾ã™ã€‚

## ã‚¼ãƒ­å¹…æ¥åˆå­ï¼ˆZero Width Joinerï¼‰
ã‚¼ãƒ­å¹…æ¥åˆå­ã¯`U+200D`ã§è¡¨ã•ã‚Œã‚‹åˆ¶å¾¡æ–‡å­—ã§ã™ã€‚
å…ˆã®`"ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦"`ã®åˆ†å‰²ã®ä¾‹ã‚’ã‚³ãƒ¼ãƒ‰ãƒã‚¤ãƒ³ãƒˆã§ç¢ºèªã—ã¦ã¿ã¾ã™ã€‚
```js
console.log(Array.from('ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦').map((char)=>char.codePointAt(0)?.toString(16))) 
//["1f468", "200d", "1f469", "200d", "1f467", "200d", "1f466"]
```
ç©ºæ–‡å­—`""`ã®ã‚ˆã†ã«ã¿ãˆã¦ã„ãŸç®‡æ‰€ã¯ã€ç¢ºã‹ã«ã‚¼ãƒ­å¹…æ¥åˆå­`U+200D`ã§ã‚ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚

https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Lexical_grammar

ã‚¼ãƒ­å¹…æ¥åˆå­ã‚’ã‚‚ã¤æ–‡å­—ã‚’æ›¸è¨˜ç´ ã‚¯ãƒ©ã‚¹ã‚¿å˜ä½ã§æ‰±ã†ã«ã¯ã€`Intl.Segmenter`ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

### `Intl.Segmenter`
`Intl.Segmenter`ã¯`locales`ã¨ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã§ã€`locale`ã«å¿œã˜ã¦æ›¸è¨˜ç´ ã‚¯ãƒ©ã‚¹ã‚¿å˜ä½ã‚„å˜èªå˜ä½ã€æ–‡å˜ä½ã§æ–‡å­—åˆ—ã‚’åˆ†å‰²ã§ãã¾ã™ã€‚
`new Intl.Segmenter("ja", { granularity: "grapheme" })`ã®ã‚ˆã†ã«å¼•æ•°ã‚’æŒ‡å®šã—ã¦Segmenterã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã€`segment`ãƒ¡ã‚½ãƒƒãƒ‰ã§æ–‡å­—åˆ—ã‹ã‚‰`Segments`ã¨ã„ã†ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ç”Ÿæˆã§ãã¾ã™ã€‚
ã“ã®`Segments`ã«ã‚ˆã£ã¦ã€æ›¸è¨˜ç´ ã‚¯ãƒ©ã‚¹ã‚¿å˜ä½ã‚„å˜èªå˜ä½ã¸ã®åˆ†å‰²ãŒã§ãã¾ã™ã€‚

`Segments`ã«ã¯`segment`ã‚„`index`ã€`input`ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’æŒã¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒè¤‡æ•°æ ¼ç´ã•ã‚Œã¦ãŠã‚Šã€`input`ãŒå¼•æ•°ã¨ã—ã¦å—ã‘å–ã£ãŸæ–‡å­—åˆ—ã€`index`ã¯ãã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒä½•ç•ªç›®ã®ã‚‚ã®ã‹ã‚’è¡¨ã™ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã€`segment`ãŒæ›¸è¨˜ç´ ã‚¯ãƒ©ã‚¹ã‚¿å˜ä½ã®æ–‡å­—ã‚„å˜èªå˜ä½ã®æ–‡å­—åˆ—ã‚’ã‚‚ã£ã¦ã„ã¾ã™ã€‚
#### æ›¸è¨˜ç´ ã‚¯ãƒ©ã‚¹ã‚¿å˜ä½ã§ã®åˆ†å‰²
```js
const graphemeSegmenter = new Intl.Segmenter('ja',{granularity:'grapheme'})

const text = "ã“ã®ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ã¯ã€ã¨ã¦ã‚‚ä»²ãŒã„ã„ã€‚4äººå®¶æ—ã ã€‚"

const graphemeSegments = graphemeSegmenter.segment(text)

console.log([...graphemeSegments].map(s => s.segment))
// ["ã“", "ã®", "ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦", "ã¯", "ã€", "ã¨", "ã¦", "ã‚‚", "ä»²", "ãŒ", "ã„", "ã„", "ã€‚", "4", "äºº", "å®¶", "æ—", "ã ", "ã€‚"]
```
ãŸã—ã‹ã«`"ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦"`ãŒè¦‹ãŸç›®ã®1æ–‡å­—ã«åˆ†å‰²ã§ãã¦ã„ã¾ã™ã­ã€‚

å˜èªå˜ä½ã§ã®åˆ†å‰²ã‚„æ–‡å˜ä½ã§ã®åˆ†å‰²ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚
#### å˜èªå˜ä½ã§ã®åˆ†å‰²
```js
const wordSegmenter = new Intl.Segmenter('ja',{granularity:'word'})

const text = "ã“ã®ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ã¯ã€ã¨ã¦ã‚‚ä»²ãŒã„ã„ã€‚4äººå®¶æ—ã ã€‚"

const wordSegments = wordSegmenter.segment(text)

console.log([...wordSegments].map(s => s.segment))
//["ã“ã®", "ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦", "ã¯", "ã€", "ã¨ã¦ã‚‚", "ä»²", "ãŒ", "ã„ã„", "ã€‚", "4", "äºº", "å®¶æ—", "ã ", "ã€‚"]
```
#### æ–‡å˜ä½ã§ã®åˆ†å‰²
```js

const sentenceSegmenter = new Intl.Segmenter('ja',{granularity:'sentence'})

const text = "ã“ã®ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ã¯ã€ã¨ã¦ã‚‚ä»²ãŒã„ã„ã€‚4äººå®¶æ—ã ã€‚"

const sentenceSegments = sentenceSegmenter.segment(text)

console.log([...sentenceSegments].map(s => s.segment))
//["ã“ã®ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ã¯ã€ã¨ã¦ã‚‚ä»²ãŒã„ã„ã€‚", "4äººå®¶æ—ã ã€‚"] 
```

https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Global_Objects/Intl/Segmenter

https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Global_Objects/Intl/Segmenter/Segmenter


[^1]: 16bit ã§è¡¨ã•ã‚Œã‚‹æ–‡å­—ç¾¤ã¯åŸºæœ¬å¤šè¨€èªé¢ï¼ˆBMP: Basic Multilingual Planeï¼‰ã¨å‘¼ã°ã‚Œã‚‹ç¯„å›²ã«å«ã¾ã‚Œã¾ã™ã€‚BMPã¯`U+0000`ã‹ã‚‰`U+FFFF`ã¾ã§ã®ã‚³ãƒ¼ãƒ‰ãƒã‚¤ãƒ³ãƒˆç¯„å›²ã®ã“ã¨ã€‚